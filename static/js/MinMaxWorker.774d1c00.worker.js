!function(){"use strict";function t(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,a=new Array(r);e<r;e++)a[e]=t[e];return a}function r(r,e){if(r){if("string"===typeof r)return t(r,e);var a=Object.prototype.toString.call(r).slice(8,-1);return"Object"===a&&r.constructor&&(a=r.constructor.name),"Map"===a||"Set"===a?Array.from(r):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(r,e):void 0}}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var a,i,n=[],o=!0,s=!1;try{for(e=e.call(t);!(o=(a=e.next()).done)&&(n.push(a.value),!r||n.length!==r);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==e.return||e.return()}finally{if(s)throw i}}return n}}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=r(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==a.return||a.return()}finally{if(l)throw o}}}}function i(e){return function(r){if(Array.isArray(r))return t(r)}(e)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function o(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,a)}return e}function s(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?o(Object(e),!0).forEach((function(r){n(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):o(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function l(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function h(t,r){for(var e=0;e<r.length;e++){var a=r[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var u;!function(t){t.Vertical="v",t.Horizontal="h"}(u||(u={}));var c,f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function v(t){if(t[0]<0||t[0]>=f.length)throw new Error("Board is to large to be represented by standard notation");return f[Math.floor(t[0]/2)]+Math.ceil(t[1]/2)}function b(t){return[2*f.indexOf(t[0])+1,2*Number.parseInt(t.substring(1))-1]}function d(t){if(t.endsWith(u.Vertical)||t.endsWith(u.Horizontal)){var r=t.endsWith(u.Vertical)?u.Vertical:u.Horizontal,e=f.indexOf(t[0]),a=Number.parseInt(t.substring(1,t.length-1));return r===u.Horizontal?{square:[2*e,2*a-1],orientation:r}:{square:[2*e+1,2*a],orientation:r}}return{target:b(t)}}function p(t){var r=t.move;return"target"in r?v(r.target):r.orientation===u.Vertical?v(r.square)+"v":v(r.square)+"h"}!function(t){t[t.white=0]="white",t[t.black=1]="black"}(c||(c={}));var w={boardWidth:9,boardHeight:9,walls:10,pawns:1},y=function(){function t(){var r=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;l(this,t),this.pawnPositions=void 0,this.wallsAvailable=void 0,this.board=void 0,this.settings=void 0,this.currentPlayer=void 0,this.width=void 0,this.height=void 0,this.illegal=!1,this.shortestPaths=void 0,this.precomputedMoves=void 0,this._children=void 0,this.settings=s(s({},w),e),this.wallsAvailable=[this.settings.walls,this.settings.walls],this.width=2*this.settings.boardWidth+1,this.height=2*this.settings.boardHeight+1,this.shortestPaths=[this.settings.boardHeight,this.settings.boardHeight];var a=Math.ceil(this.settings.boardWidth/2);this.pawnPositions=[[1,2*a-1],[this.height-2,2*a-1]],this.board=new Array(this.height).fill(0).map((function(){return new Int8Array(r.width).fill(-1)}));for(var i=0;i<this.height;i++)this.board[i][0]=1,this.board[i][this.width-1]=1;for(var n=0;n<this.width;n++)this.board[0][n]=1,this.board[this.height-1][n]=1;this.currentPlayer=c.white}var r,n,o;return r=t,o=[{key:"fromNotation",value:function(r,e){var i=new t(e),n=r.match(/(.*)\/(.*)\/(.*) (.*)\/(\d+) (\d+)\/(\d)/);try{if(n&&8===n.length){if(null!==n[1]){var o=n[1].trim();if(o.length>0){var s,l=a(o.split(" "));try{for(l.s();!(s=l.n()).done;){var h=d(s.value+u.Horizontal);i.placeWall(h,i.board)}}catch(y){l.e(y)}finally{l.f()}}}if(null!==n[2]){var f=n[2].trim();if(f.length>0){var v,p=a(f.split(" "));try{for(p.s();!(v=p.n()).done;){var w=d(v.value+u.Vertical);i.placeWall(w,i.board)}}catch(y){p.e(y)}finally{p.f()}}}return i.pawnPositions[0]=b(n[3]),i.pawnPositions[1]=b(n[4]),i.wallsAvailable[0]=Number.parseInt(n[5]),i.wallsAvailable[1]=Number.parseInt(n[6]),i.currentPlayer="1"===n[7]?c.black:c.white,i.shortestPaths[c.white]=i.whiteBFS(i.pawnPositions[c.white]),i.shortestPaths[c.black]=i.blackBFS(i.pawnPositions[c.black]),i}throw console.error("invalid matches",n),new Error("Invalid State notation")}catch(g){throw console.log(r,n,g),new Error("Invalid State notation")}}}],(n=[{key:"isLegal",value:function(t){return"string"===typeof t?this.legalMoves.has(t):this.legalMoves.has(p({move:t}))}},{key:"winner",value:function(){return this.pawnPositions[c.white][0]>=this.height-2?c.white:this.pawnPositions[c.black][0]<=1?c.black:null}},{key:"isGameOver",value:function(){return null!==this.winner()}},{key:"placeWall",value:function(t,r){var a=e(t.square,2),i=a[0],n=a[1];t.orientation===u.Horizontal?(r[i][n]=1,r[i][n+2]=1):(r[i][n]=1,r[i+2][n]=1)}},{key:"makeMove",value:function(r){if("string"===typeof r){if(this.legalMoves.has(r)){var e=this.children.get(r);if(e)return e}r=d(r)}for(var a=new t(this.settings),n=0;n<this.height;n++)for(var o=0;o<this.width;o++)a.board[n][o]=this.board[n][o],n%2==0&&o%2==0&&(a.board[n][o]=-1),n%2==1&&o%2==1&&(a.board[n][o]=-1);a.pawnPositions=i(this.pawnPositions),a.wallsAvailable=i(this.wallsAvailable),a.currentPlayer=this.currentPlayer===c.white?c.black:c.white,"target"in r?a.pawnPositions[this.currentPlayer]=r.target:(a.placeWall(r,a.board),a.wallsAvailable[this.currentPlayer]--);var s=a.whiteBFS(a.pawnPositions[c.white]);-1===s&&(a.illegal=!0),a.shortestPaths[c.white]=s;var l=a.blackBFS(a.pawnPositions[c.black]);return-1===l&&(a.illegal=!0),a.shortestPaths[c.black]=l,a}},{key:"generateManhattanMoves",value:function(t,r){var a=e(t,2),i=a[0],n=a[1],o=[[i+2,n],[i,n+2],[i,n-2],[i-2,n]],s=[r[i+1][n],r[i][n+1],r[i][n-1],r[i-1][n]];return o.filter((function(t,r){return 1!=s[r]}))}},{key:"generatePawnMoves",value:function(t){var r=this,e=[],i=this.pawnPositions[this.opponent];return this.generateManhattanMoves(t,this.board).forEach((function(n){if(n[0]===i[0]&&n[1]===i[1]){var o=[(i[0]-t[0])/2,(i[1]-t[1])/2],s=[i[0]+o[0],i[1]+o[1]];if(1!==r.board[s[0]][s[1]])e.push({target:[s[0]+o[0],s[1]+o[1]]});else{var l,h=a(r.generateManhattanMoves(i,r.board));try{for(h.s();!(l=h.n()).done;)n=l.value,i[0]===t[0]&&i[1]===t[1]||e.push({target:n})}catch(u){h.e(u)}finally{h.f()}}}else e.push({target:n})})),e}},{key:"opponent",get:function(){return this.currentPlayer===c.white?c.black:c.white}},{key:"whiteBFS",value:function(t){var r=this,a=[t];this.board[t[0]][t[1]]=0;for(var i=function(){var t=a.shift();if(!t)return"continue";var i=e(t,2),n=i[0],o=i[1];if(n>=r.height-2)return{v:r.board[n][o]};var s=[[n+2,o],[n,o+2],[n,o-2],[n-2,o]],l=[r.board[n+1][o],r.board[n][o+1],r.board[n][o-1],r.board[n-1][o]];s.forEach((function(t,i){var s=e(t,2),h=s[0],u=s[1];1!==l[i]&&-1===r.board[h][u]&&(r.board[h][u]=r.board[n][o]+1,a.push([h,u]))}))};a.length>0;){var n=i();if("continue"!==n&&"object"===typeof n)return n.v}return-1}},{key:"blackBFS",value:function(t){var r=this,a=[t];this.board[t[0]-1][t[1]-1]=0;for(var i=function(){var t=a.shift();if(!t)return"continue";var i=e(t,2),n=i[0],o=i[1];if(n<=1)return{v:r.board[n-1][o-1]};var s=[[n+2,o],[n,o+2],[n,o-2],[n-2,o]],l=[r.board[n+1][o],r.board[n][o+1],r.board[n][o-1],r.board[n-1][o]];s.forEach((function(t,i){var s=e(t,2),h=s[0],u=s[1];1!==l[i]&&-1===r.board[h-1][u-1]&&(r.board[h-1][u-1]=r.board[n-1][o-1]+1,a.push([h,u]))}))};a.length>0;){var n=i();if("continue"!==n&&"object"===typeof n)return n.v}return-1}},{key:"generateWallMoves",value:function(){var t=[];if(0===this.wallsAvailable[this.currentPlayer])return t;for(var r=1;r<this.height-3;r+=2)for(var e=2;e<this.width-2;e+=2)if(1!==this.board[r][e]&&1!==this.board[r+2][e]&&(1!==this.board[r+1][e-1]||1!==this.board[r+1][e+1])){var a={square:[r,e],orientation:u.Vertical};t.push(a)}for(var i=2;i<this.height-1;i+=2)for(var n=1;n<this.width-2;n+=2)if(1!==this.board[i][n]&&1!==this.board[i][n+2]&&(1!==this.board[i-1][n+1]||1!==this.board[i+1][n+1])){var o={square:[i,n],orientation:u.Horizontal};t.push(o)}return t}},{key:"generateAllMoves",value:function(){var t=[];return this.isGameOver()||(t=(t=this.generatePawnMoves(this.pawnPositions[this.currentPlayer])).concat(this.generateWallMoves())),t}},{key:"computeChildren",value:function(){var t=new Map;this.precomputedMoves=new Set;var r,e=a(this.generateAllMoves());try{for(e.s();!(r=e.n()).done;){var i=r.value,n=p({move:i}),o=this.makeMove(i);o.illegal||(this.precomputedMoves.add(n),t.set(n,o))}}catch(s){e.e(s)}finally{e.f()}return t}},{key:"children",get:function(){return void 0===this._children&&(this._children=this.computeChildren()),this._children}},{key:"legalMoves",get:function(){return this.precomputedMoves||(this.precomputedMoves=new Set,this.computeChildren()),this.precomputedMoves}},{key:"toString",value:function(){for(var t="",r=1;r<this.height-1;r++){for(var e=1;e<this.width-1;e++)r%2===0&&e%2===0?(this.board[r][e],t+="+"):r%2!==e%2?1===this.board[r][e]?t+="\u25a0":t+=" ":r%2===1&&e%2===1&&(this.pawnPositions[c.white][0]===r&&this.pawnPositions[c.white][1]===e?t+="\u25cb":this.pawnPositions[c.black][0]===r&&this.pawnPositions[c.black][1]===e?t+="\u25cf":t+=".");t+="\n"}return t}},{key:"toNotation",value:function(){for(var t="",r=2;r<this.height-1;r+=2)for(var e=1;e<this.width-2;e+=2)1===this.board[r][e]&&1===this.board[r][e+2]&&(t+=v([r,e])+" ",e+=2);t+="/";for(var a=2;a<this.width-2;a+=2)for(var i=1;i<this.height-3;i+=2)1===this.board[i][a]&&1===this.board[i+2][a]&&(t+=v([i,a])+" ",i+=2);return t+="/",t+=v(this.pawnPositions[0]),t+=" "+v(this.pawnPositions[1]),t+="/",t+=this.wallsAvailable[0],t+=" "+this.wallsAvailable[1],t+="/",t+=this.currentPlayer}}])&&h(r.prototype,n),o&&h(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}();function g(t){var r=t.state,e=t.alpha,n=t.beta,o=t.maxPlayer,s=t.depth,l=t.maximizing;if(r.isGameOver())return r.winner()===o?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(s<=0)return function(t,r){var e=t.shortestPaths[r],a=r===c.white?c.black:c.white,i=t.shortestPaths[a];return t.wallsAvailable[0],t.wallsAvailable[1],i-e+0*t.wallsAvailable[r]-0*t.wallsAvailable[a]+Math.random()}(r,o);var h=i(r.children.values());if(function(t){for(var r=t.length-1;r>0;r--){var e=Math.floor(Math.random()*(r+1)),a=[t[e],t[r]];t[r]=a[0],t[e]=a[1]}}(h),l){var u,f=Number.NEGATIVE_INFINITY,v=a(h);try{for(v.s();!(u=v.n()).done;){var b=u.value;if(f=Math.max(f,g({state:b,alpha:e,beta:n,maxPlayer:o,depth:s-1,maximizing:!1})),e=Math.max(e,f),f>=n)break}}catch(m){v.e(m)}finally{v.f()}return f}var d,p=Number.POSITIVE_INFINITY,w=a(h);try{for(w.s();!(d=w.n()).done;){var y=d.value;if(p=Math.min(p,g({state:y,alpha:e,beta:n,maxPlayer:o,depth:s-1,maximizing:!0})),n=Math.min(n,p),p<=e)break}}catch(m){w.e(m)}finally{w.f()}return p}self;onmessage=function(t){var r=e(t.data,8),a=r[0],i=r[1],n=r[2],o=r[3],s=r[4],l=r[5],h=r[6],u=r[7];try{var c=g({state:y.fromNotation(i,n),alpha:o,beta:s,maxPlayer:l,depth:h,maximizing:u});postMessage([a,c])}catch(t){console.error(t,i)}}}();
//# sourceMappingURL=MinMaxWorker.774d1c00.worker.js.map